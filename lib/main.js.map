{"version":3,"file":"main.js","sources":["../src/mirror.js","../src/input.js","../src/editable.js","../src/utils.js","../src/main.js"],"sourcesContent":["const attributes = [\n  'borderBottomWidth',\n  'borderLeftWidth',\n  'borderRightWidth',\n  'borderTopStyle',\n  'borderRightStyle',\n  'borderBottomStyle',\n  'borderLeftStyle',\n  'borderTopWidth',\n  'boxSizing',\n  'fontFamily',\n  'fontSize',\n  'fontWeight',\n  'height',\n  'letterSpacing',\n  'lineHeight',\n  'marginBottom',\n  'marginLeft',\n  'marginRight',\n  'marginTop',\n  'outlineWidth',\n  'overflow',\n  'overflowX',\n  'overflowY',\n  'paddingBottom',\n  'paddingLeft',\n  'paddingRight',\n  'paddingTop',\n  'textAlign',\n  'textOverflow',\n  'textTransform',\n  'whiteSpace',\n  'wordBreak',\n  'wordWrap',\n];\n\n/**\n * Create a mirror\n *\n * @param {Element} element The element\n * @param {string} html The html\n *\n * @return {Object} The mirror object\n */\nconst createMirror = (element, html) => {\n\n  /**\n   * The mirror element\n   */\n  const mirror = document.createElement('div');\n\n  /**\n   * Create the CSS for the mirror object\n   *\n   * @returns {Object} The style object\n   */\n  const mirrorCss = () => {\n    const css = {\n      position: 'absolute',\n      left: -9999,\n      top: 0,\n      zIndex: -2000\n    };\n\n    if (element.tagName === 'TEXTAREA') {\n      attributes.push('width');\n    }\n\n    attributes.forEach((attr) => {\n      css[attr] = getComputedStyle(element)[attr];\n    });\n\n    return css;\n  };\n\n  /**\n   * Initialize the mirror\n   *\n   * @param {string} html The html\n   */\n  const initialize = (html) => {\n    const styles = mirrorCss();\n    Object.keys(styles).forEach(key => {\n      mirror.style[key] = styles[key];\n    });\n    mirror.innerHTML = html;\n    element.parentNode.insertBefore(mirror, element.nextSibling);\n  };\n\n  /**\n   * Get the rect\n   *\n   * @returns {Rect} The bounding rect\n   */\n  const rect = () => {\n    const marker = mirror.ownerDocument.getElementById('caret-position-marker');\n    const boundingRect = {\n      left: marker.offsetLeft,\n      top: marker.offsetTop,\n      height: marker.offsetHeight\n    };\n    mirror.parentNode.removeChild(mirror);\n\n    return boundingRect;\n  };\n\n  initialize(html);\n\n  return {\n    rect,\n  };\n};\n\nexport default createMirror;\n","import createMirror from './mirror';\n\n/**\n * Create a Input caret object.\\\n *\n * @param {Element} element The element\n * @param {Object} ctx The context\n */\nconst createInputCaret = (element, ctx) => {\n\n  /**\n   * Get position of old IE\n   *\n   * @returns {number}\n   */\n  const getIEPos = () => {\n    const range = ctx.document.selection.createRange();\n    let pos = 0;\n\n    if (range && range.parentElement() === element) {\n      /* eslint-disable */\n      const value = element.value.replace(/\\r\\n/g, \"\\n\");\n      /* eslint-enable */\n      const textInputRange = element.createTextRange();\n      textInputRange.moveToBookmark(range.getBookmark());\n      const endRange = element.createTextRange();\n      endRange.collapse(false);\n      if (textInputRange.compareEndPoints('StartToEnd', endRange) > -1) {\n        pos = value.length;\n      } else {\n        pos = -textInputRange.moveStart('character', -value.length);\n      }\n    }\n\n    return pos;\n  };\n\n  /**\n   * Get the current position\n   *\n   * @returns {number}\n   */\n  const getPos = () => {\n    if (ctx.document.selection) {\n      return getIEPos();\n    }\n\n    return element.selectionStart;\n  };\n\n  /**\n   * Set the position\n   * @todo: Where is this being used?\n   * @param {number} pos The position\n   */\n  const setPos = (pos) => {\n    // IE\n    if (ctx.document.selection) {\n      const range = element.createTextRange();\n      range.move('characters', pos);\n      range.select();\n    } else if (element.setSelectionRange) {\n      element.setSelectionRange(pos, pos);\n    }\n\n    return element;\n  };\n\n  /**\n   * Get the offset for old IE\n   *\n   * @param {number} pos The position\n   */\n  const getIEOffset = (pos) => {\n    const range = element.createTextRange();\n    const position = pos || getPos();\n    range.move('character', position);\n\n    return {\n      x: range.boundingLeft,\n      y: range.boundingTop,\n      h: range.boundingHeight\n    };\n  };\n\n  /**\n   * The offset\n   *\n   * @param {number} pos String\n   */\n  const getOffset = (pos) => {\n    let offset;\n    if (ctx.document.selection) {\n      offset = getIEOffset(pos);\n      offset.top += ctx.window.scrollTop + element.scrollTop;\n      offset.left += ctx.window.scrollLeft + element.scrollLeft;\n    } else {\n      const rect = element.getBoundingClientRect();\n      const position = getPosition(pos);\n      offset = {\n        top: rect.top + position.top + ctx.document.body.scrollTop,\n        left: rect.left + position.left + ctx.document.body.scrollLeft\n      };\n    }\n\n    return offset;\n  };\n\n  /**\n   * Get the current position\n   *\n   * @param {number} pos The position\n   */\n  const getPosition = (pos) => {\n    const format = (val) => {\n      let value = val.replace(/<|>|`|\"|&/g, '?')\n        .replace(/\\r\\n|\\r|\\n/g,'<br/>');\n      if (/firefox/i.test(navigator.userAgent)) {\n        value = value.replace(/\\s/g, '&nbsp;');\n      }\n      return value;\n    };\n\n    const position = pos === undefined ? getPos() : pos;\n    const startRange = element.value.slice(0, position);\n    const endRange = element.value.slice(position);\n    let html = `<span style=\"position: relative; display: inline;\">${format(startRange)}</span>`;\n    html += '<span id=\"caret-position-marker\" style=\"position: relative; display: inline;\">|</span>';\n    html += `<span style=\"position: relative; display: inline;\">${format(endRange)}</span>`;\n\n    const mirror = createMirror(element, html);\n    return mirror.rect();\n  };\n\n  return {\n    getPos,\n    setPos,\n    getIEPos,\n    getIEOffset,\n    getOffset,\n    getPosition,\n  };\n};\n\nexport default createInputCaret;\n","const createEditableCaret = (element) => {\n\n  return {\n\n  };\n};\n\nexport default createEditableCaret;\n","export const isContentEditable = (element) => !!(\n  element.contentEditable &&\n  element.contentEditable === true\n);\n\nexport const getContext = (settings = {}) => {\n  const { iframe } = settings;\n  if (iframe) {\n    return {\n      iframe,\n      window: iframe.contentWindow,\n      document: iframe.contentDocument || iframe.contentWindow.document,\n    };\n  }\n\n  return {\n    window,\n    document,\n  };\n};\n","import createInputCaret from './input';\nimport createEditableCaret from './editable';\nimport { isContentEditable, getContext } from './utils';\n\n\nconst createCaret = (element, ctx) => {\n  if (isContentEditable(element)) {\n    return createEditableCaret(element);\n  }\n\n  return createInputCaret(element, ctx);\n};\n\nexport const position = (element, value) => {\n  let val = value;\n  const ctx = getContext();\n  const caret = createCaret(element, ctx);\n  return caret.getPos(val);\n};\n\nexport const offset = (element, pos) => {\n  const ctx = getContext();\n  const caret = createCaret(element, ctx);\n  return caret.getOffset(pos);\n};\n\n\n// Just tests\nconst input = document.getElementById('input');\ninput.addEventListener('click', () => {\n  const pos = position(input);\n  console.log(pos);\n  console.log(offset(input, pos));\n});\n"],"names":["attributes","createMirror","element","html","mirror","document","createElement","mirrorCss","css","tagName","push","forEach","attr","getComputedStyle","initialize","styles","keys","key","style","innerHTML","parentNode","insertBefore","nextSibling","rect","marker","ownerDocument","getElementById","boundingRect","offsetLeft","offsetTop","offsetHeight","removeChild","createInputCaret","ctx","getIEPos","range","selection","createRange","pos","parentElement","value","replace","textInputRange","createTextRange","moveToBookmark","getBookmark","endRange","collapse","compareEndPoints","length","moveStart","getPos","selectionStart","setPos","move","select","setSelectionRange","getIEOffset","position","boundingLeft","boundingTop","boundingHeight","getOffset","offset","top","window","scrollTop","left","scrollLeft","getBoundingClientRect","getPosition","body","format","val","test","navigator","userAgent","undefined","startRange","slice","createEditableCaret","isContentEditable","contentEditable","getContext","settings","iframe","contentWindow","contentDocument","createCaret","caret","input","addEventListener","log"],"mappings":"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"}