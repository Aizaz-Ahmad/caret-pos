{"version":3,"file":"main.js","sources":["../src/main.js"],"sourcesContent":["const createEditableCaret = (element) => {\n\n  return {\n\n  };\n};\n\nconst createMirror = (element, html) => {\n  const attributes = [\n    'borderBottomWidth',\n    'borderLeftWidth',\n    'borderRightWidth',\n    'borderTopStyle',\n    'borderRightStyle',\n    'borderBottomStyle',\n    'borderLeftStyle',\n    'borderTopWidth',\n    'boxSizing',\n    'fontFamily',\n    'fontSize',\n    'fontWeight',\n    'height',\n    'letterSpacing',\n    'lineHeight',\n    'marginBottom',\n    'marginLeft',\n    'marginRight',\n    'marginTop',\n    'outlineWidth',\n    'overflow',\n    'overflowX',\n    'overflowY',\n    'paddingBottom',\n    'paddingLeft',\n    'paddingRight',\n    'paddingTop',\n    'textAlign',\n    'textOverflow',\n    'textTransform',\n    'whiteSpace',\n    'wordBreak',\n    'wordWrap',\n  ];\n\n  const mirror = document.createElement('div');\n\n  const mirrorCss = () => {\n    const css = {\n      position: 'absolute',\n      left: -9999,\n      top: 0,\n      zIndex: -2000\n    };\n\n    if (element.tagName === 'TEXTAREA') {\n      attributes.push('width');\n    }\n\n    attributes.forEach((attr) => {\n      css[attr] = getComputedStyle(element)[attr];\n    });\n\n    return css;\n  };\n\n  const create = (html) => {\n    const styles = mirrorCss();\n    Object.keys(styles).forEach(key => {\n      mirror.style[key] = styles[key];\n    });\n    mirror.innerHTML = html;\n    element.parentNode.insertBefore(mirror, element.nextSibling);\n  };\n\n  const rect = () => {\n    const marker = mirror.ownerDocument.getElementById('caret-position-marker');\n    const boundingRect = {\n      left: marker.offsetLeft,\n      top: marker.offsetTop,\n      height: marker.offsetHeight\n    };\n    mirror.parentNode.removeChild(mirror);\n\n    return boundingRect;\n  };\n\n  create(html);\n\n  return {\n    rect,\n  };\n};\n\nconst createInputCaret = (element, ctx) => {\n\n  const getIEPos = () => {\n    const range = ctx.document.selection.createRange();\n    let pos = 0;\n\n    if (range && range.parentElement() === element) {\n      /* eslint-disable */\n      const value = element.value.replace(/\\r\\n/g, \"\\n\");\n      /* eslint-enable */\n      const textInputRange = element.createTextRange();\n      textInputRange.moveToBookmark(range.getBookmark());\n      const endRange = element.createTextRange();\n      endRange.collapse(false);\n      if (textInputRange.compareEndPoints('StartToEnd', endRange) > -1) {\n        pos = value.length;\n      } else {\n        pos = -textInputRange.moveStart('character', -value.length);\n      }\n    }\n\n    return pos;\n  };\n\n  const getPos = () => {\n    if (ctx.document.selection) {\n      return getIEPos();\n    }\n\n    return element.selectionStart;\n  };\n\n  const setPos = (pos) => {\n    // IE\n    if (ctx.document.selection) {\n      const range = element.createTextRange();\n      range.move('characters', pos);\n      range.select();\n    } else if (element.setSelectionRange) {\n      element.setSelectionRange(pos, pos);\n    }\n\n    return element;\n  };\n\n  const getIEOffset = (pos) => {\n    const range = element.createTextRange();\n    const position = pos || getPos();\n    range.move('character', position);\n\n    return {\n      x: range.boundingLeft,\n      y: range.boundingTop,\n      h: range.boundingHeight\n    };\n  };\n\n  const getOffset = (pos) => {\n    let offset;\n    if (ctx.document.selection) {\n      offset = getIEOffset(pos);\n      offset.top += ctx.window.scrollTop + element.scrollTop;\n      offset.left += ctx.window.scrollLeft + element.scrollLeft;\n    } else {\n      const rect = element.getBoundingClientRect();\n      const position = getPosition(pos);\n      offset = {\n        top: rect.top + position.top + ctx.document.body.scrollTop,\n        left: rect.left + position.left + ctx.document.body.scrollLeft\n      };\n    }\n\n    return offset;\n  };\n\n  const getPosition = (pos) => {\n    const format = (val) => {\n      let value = val.replace(/<|>|`|\"|&/g, '?')\n        .replace(/\\r\\n|\\r|\\n/g,'<br/>');\n      if (/firefox/i.test(navigator.userAgent)) {\n        value = value.replace(/\\s/g, '&nbsp;');\n      }\n      return value;\n    };\n\n    const position = pos === undefined ? getPos() : pos;\n    const startRange = element.value.slice(0, position);\n    const endRange = element.value.slice(position);\n    let html = `<span style=\"position: relative; display: inline;\">${format(startRange)}</span>`;\n    html += '<span id=\"caret-position-marker\" style=\"position: relative; display: inline;\">|</span>';\n    html += `<span style=\"position: relative; display: inline;\">${format(endRange)}</span>`;\n\n    const mirror = createMirror(element, html);\n    return mirror.rect();\n  };\n\n  return {\n    getPos,\n    setPos,\n    getIEPos,\n    getIEOffset,\n    getOffset,\n    getPosition,\n  };\n};\n\nconst isContentEditable = (element) => !!(\n  element.contentEditable &&\n  element.contentEditable === true\n);\n\nexport const getContext = (settings = {}) => {\n  const { iframe } = settings;\n  if (iframe) {\n    return {\n      iframe,\n      window: iframe.contentWindow,\n      document: iframe.contentDocument || iframe.contentWindow.document,\n    };\n  }\n\n  return {\n    window,\n    document,\n  };\n};\n\nconst createCaret = (element, ctx) => {\n  if (isContentEditable(element)) {\n    return createEditableCaret(element);\n  }\n\n  return createInputCaret(element, ctx);\n};\n\nexport const position = (element, value) => {\n  let val = value;\n  const ctx = getContext();\n  const caret = createCaret(element, ctx);\n  return caret.getPos(val);\n};\n\nexport const offset = (element, pos) => {\n  const ctx = getContext();\n  const caret = createCaret(element, ctx);\n  return caret.getOffset(pos);\n};\n\nconst input = document.getElementById('input');\ninput.addEventListener('click', () => {\n  const pos = position(input);\n  console.log(pos);\n  console.log(offset(input, pos));\n});\n"],"names":["createEditableCaret","element","createMirror","html","attributes","mirror","document","createElement","mirrorCss","css","tagName","push","forEach","attr","getComputedStyle","create","styles","keys","key","style","innerHTML","parentNode","insertBefore","nextSibling","rect","marker","ownerDocument","getElementById","boundingRect","offsetLeft","offsetTop","offsetHeight","removeChild","createInputCaret","ctx","getIEPos","range","selection","createRange","pos","parentElement","value","replace","textInputRange","createTextRange","moveToBookmark","getBookmark","endRange","collapse","compareEndPoints","length","moveStart","getPos","selectionStart","setPos","move","select","setSelectionRange","getIEOffset","position","boundingLeft","boundingTop","boundingHeight","getOffset","offset","top","window","scrollTop","left","scrollLeft","getBoundingClientRect","getPosition","body","format","val","test","navigator","userAgent","undefined","startRange","slice","isContentEditable","contentEditable","getContext","settings","iframe","contentWindow","contentDocument","createCaret","caret","input","addEventListener","log"],"mappings":"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"}